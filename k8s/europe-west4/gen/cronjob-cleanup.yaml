"apiVersion": "batch/v1beta1"
"kind": "CronJob"
"metadata":
  "name": "cronjob-cleanup"
"spec":
  "jobTemplate":
    "spec":
      "backoffLimit": 0
      "template":
        "spec":
          "containers":
          - "args":
            - |
              cat > tests.txt <<EOF
              cronjob.batch/flax-latest-imagenet-conv-v3-32-1vm
              cronjob.batch/flax-latest-imagenet-func-v3-32-1vm
              cronjob.batch/jax-pod-head-v2-alpha-func-v2-32-1vm
              cronjob.batch/jax-pod-head-v2-nightly-func-v2-32-1vm
              cronjob.batch/jax-pod-latest-v2-alpha-func-v2-32-1vm
              cronjob.batch/pt-nightly-resnet50-mp-conv-v3-32-1vm
              cronjob.batch/pt-nightly-resnet50-pod-func-v3-32
              cronjob.batch/pt-nightly-roberta-pre-func-v3-32
              cronjob.batch/pt-r1.10-fs-transformer-func-v3-32
              cronjob.batch/pt-r1.10-resnet50-mp-conv-v3-32
              cronjob.batch/pt-r1.10-resnet50-pod-func-v3-32
              cronjob.batch/pt-r1.10-roberta-pre-func-v3-32
              cronjob.batch/pt-r1.11-resnet50-mp-conv-v3-32-1vm
              cronjob.batch/pt-r1.11-resnet50-pod-func-v3-32
              cronjob.batch/pt-r1.11-roberta-pre-func-v3-32
              cronjob.batch/tf-nightly-classifier-efficientnet-conv-v2-32
              cronjob.batch/tf-nightly-classifier-efficientnet-conv-v3-32
              cronjob.batch/tf-nightly-classifier-resnet-conv-v2-32
              cronjob.batch/tf-nightly-classifier-resnet-conv-v3-32
              cronjob.batch/tf-nightly-classifier-resnet-func-v2-32
              cronjob.batch/tf-nightly-classifier-resnet-func-v2-32-1vm
              cronjob.batch/tf-nightly-classifier-resnetrs-conv-v2-32
              cronjob.batch/tf-nightly-classifier-resnetrs-conv-v3-32
              cronjob.batch/tf-nightly-maskrcnn-conv-v2-32
              cronjob.batch/tf-nightly-maskrcnn-conv-v3-32
              cronjob.batch/tf-nightly-maskrcnn-func-v2-32
              cronjob.batch/tf-nightly-mnist-conv-v2-32-1vm
              cronjob.batch/tf-nightly-ncf-conv-v2-32
              cronjob.batch/tf-nightly-nlp-bert-mnli-conv-v2-32
              cronjob.batch/tf-nightly-nlp-bert-mnli-conv-v3-32
              cronjob.batch/tf-nightly-nlp-wmt-transformer-conv-v2-32
              cronjob.batch/tf-nightly-nlp-wmt-transformer-conv-v3-32
              cronjob.batch/tf-nightly-ranking-dcn-conv-v3-32
              cronjob.batch/tf-nightly-ranking-dlrm-conv-v2-32-1vm
              cronjob.batch/tf-nightly-ranking-dlrm-conv-v3-32
              cronjob.batch/tf-nightly-resnet-ctl-conv-v2-32
              cronjob.batch/tf-nightly-resnet-ctl-conv-v3-32
              cronjob.batch/tf-nightly-retinanet-conv-v2-32
              cronjob.batch/tf-nightly-retinanet-conv-v3-32
              cronjob.batch/tf-nightly-shapemask-conv-v3-32
              cronjob.batch/tf-nightly-transformer-translate-conv-v2-32
              cronjob.batch/tf-nightly-transformer-translate-conv-v3-32
              cronjob.batch/tf-nightly-transformer-translate-func-v2-32
              cronjob.batch/tf-nightly-vision-resnet-conv-v2-32
              cronjob.batch/tf-nightly-vision-resnet-conv-v3-32
              cronjob.batch/tf-nightly-vision-resnetrs-conv-v2-32
              cronjob.batch/tf-nightly-vision-resnetrs-conv-v3-32
              cronjob.batch/tf-r1.15.5-bert-conv-v2-32
              cronjob.batch/tf-r1.15.5-bert-func-v2-32
              cronjob.batch/tf-r1.15.5-bert-func-v3-32
              cronjob.batch/tf-r1.15.5-efficientnet-func-v2-32
              cronjob.batch/tf-r1.15.5-efficientnet-func-v3-32
              cronjob.batch/tf-r1.15.5-mask-rcnn-conv-v2-32
              cronjob.batch/tf-r1.15.5-mask-rcnn-func-v2-32
              cronjob.batch/tf-r1.15.5-mask-rcnn-func-v3-32
              cronjob.batch/tf-r1.15.5-resnet-conv-v2-32
              cronjob.batch/tf-r1.15.5-resnet-conv-v3-32
              cronjob.batch/tf-r1.15.5-resnet-func-v2-32
              cronjob.batch/tf-r1.15.5-resnet-func-v3-32
              cronjob.batch/tf-r2.4.2-keras-api-save-and-load-v2-32
              cronjob.batch/tf-r2.5.0-keras-api-save-and-load-v2-32
              cronjob.batch/tf-r2.7.0-bert-mnli-func-v2-32-1vm
              cronjob.batch/tf-r2.7.0-bert-mnli-func-v3-32
              cronjob.batch/tf-r2.7.0-bert-mnli-func-v3-32-1vm
              cronjob.batch/tf-r2.7.0-classifier-efficientnet-func-v2-32
              cronjob.batch/tf-r2.7.0-classifier-efficientnet-func-v2-32-1vm
              cronjob.batch/tf-r2.7.0-classifier-efficientnet-func-v3-32
              cronjob.batch/tf-r2.7.0-classifier-resnet-func-v2-32
              cronjob.batch/tf-r2.7.0-classifier-resnet-func-v2-32-1vm
              cronjob.batch/tf-r2.7.0-classifier-resnet-func-v3-32
              cronjob.batch/tf-r2.7.0-classifier-resnet-func-v3-32-1vm
              cronjob.batch/tf-r2.7.0-classifier-resnetrs-func-v2-32
              cronjob.batch/tf-r2.7.0-classifier-resnetrs-func-v3-32
              cronjob.batch/tf-r2.7.0-maskrcnn-func-v2-32
              cronjob.batch/tf-r2.7.0-maskrcnn-func-v2-32-1vm
              cronjob.batch/tf-r2.7.0-maskrcnn-func-v3-32
              cronjob.batch/tf-r2.7.0-ncf-func-v2-32-1vm
              cronjob.batch/tf-r2.7.0-ncf-func-v3-32
              cronjob.batch/tf-r2.7.0-ranking-dcn-func-v2-32
              cronjob.batch/tf-r2.7.0-ranking-dlrm-func-v3-32
              cronjob.batch/tf-r2.7.0-resnet-ctl-func-v2-32-1vm
              cronjob.batch/tf-r2.7.0-resnet-ctl-func-v3-32
              cronjob.batch/tf-r2.7.0-retinanet-func-v2-32
              cronjob.batch/tf-r2.7.0-retinanet-func-v2-32-1vm
              cronjob.batch/tf-r2.7.0-retinanet-func-v3-32
              cronjob.batch/tf-r2.7.0-shapemask-func-v2-32
              cronjob.batch/tf-r2.7.0-shapemask-func-v2-32-1vm
              cronjob.batch/tf-r2.7.0-shapemask-func-v3-32
              cronjob.batch/tf-r2.7.0-transformer-translate-func-v2-32
              cronjob.batch/tf-r2.7.0-transformer-translate-func-v2-32-1vm
              cronjob.batch/tf-r2.7.0-transformer-translate-func-v3-32
              cronjob.batch/tf-r2.8.0-bert-mnli-conv-v3-32
              cronjob.batch/tf-r2.8.0-bert-mnli-func-v2-32-1vm
              cronjob.batch/tf-r2.8.0-bert-mnli-func-v3-32
              cronjob.batch/tf-r2.8.0-bert-mnli-func-v3-32-1vm
              cronjob.batch/tf-r2.8.0-classifier-efficientnet-conv-v3-32
              cronjob.batch/tf-r2.8.0-classifier-efficientnet-func-v2-32
              cronjob.batch/tf-r2.8.0-classifier-efficientnet-func-v2-32-1vm
              cronjob.batch/tf-r2.8.0-classifier-efficientnet-func-v3-32
              cronjob.batch/tf-r2.8.0-classifier-resnet-conv-v3-32
              cronjob.batch/tf-r2.8.0-classifier-resnet-func-v2-32
              cronjob.batch/tf-r2.8.0-classifier-resnet-func-v2-32-1vm
              cronjob.batch/tf-r2.8.0-classifier-resnet-func-v3-32
              cronjob.batch/tf-r2.8.0-classifier-resnet-func-v3-32-1vm
              cronjob.batch/tf-r2.8.0-classifier-resnetrs-conv-v3-32
              cronjob.batch/tf-r2.8.0-classifier-resnetrs-func-v2-32
              cronjob.batch/tf-r2.8.0-classifier-resnetrs-func-v3-32
              cronjob.batch/tf-r2.8.0-maskrcnn-conv-v3-32
              cronjob.batch/tf-r2.8.0-maskrcnn-func-v2-32
              cronjob.batch/tf-r2.8.0-maskrcnn-func-v2-32-1vm
              cronjob.batch/tf-r2.8.0-maskrcnn-func-v3-32
              cronjob.batch/tf-r2.8.0-mnist-conv-v2-32-1vm
              cronjob.batch/tf-r2.8.0-ncf-func-v2-32-1vm
              cronjob.batch/tf-r2.8.0-ncf-func-v3-32
              cronjob.batch/tf-r2.8.0-ranking-dcn-conv-v3-32
              cronjob.batch/tf-r2.8.0-ranking-dcn-func-v2-32
              cronjob.batch/tf-r2.8.0-ranking-dlrm-conv-v3-32
              cronjob.batch/tf-r2.8.0-ranking-dlrm-func-v3-32
              cronjob.batch/tf-r2.8.0-resnet-ctl-conv-v3-32
              cronjob.batch/tf-r2.8.0-resnet-ctl-func-v2-32-1vm
              cronjob.batch/tf-r2.8.0-resnet-ctl-func-v3-32
              cronjob.batch/tf-r2.8.0-retinanet-conv-v3-32
              cronjob.batch/tf-r2.8.0-retinanet-func-v2-32
              cronjob.batch/tf-r2.8.0-retinanet-func-v2-32-1vm
              cronjob.batch/tf-r2.8.0-retinanet-func-v3-32
              cronjob.batch/tf-r2.8.0-shapemask-conv-v3-32
              cronjob.batch/tf-r2.8.0-shapemask-func-v2-32
              cronjob.batch/tf-r2.8.0-shapemask-func-v2-32-1vm
              cronjob.batch/tf-r2.8.0-shapemask-func-v3-32
              cronjob.batch/tf-r2.8.0-transformer-translate-conv-v3-32
              cronjob.batch/tf-r2.8.0-transformer-translate-func-v2-32
              cronjob.batch/tf-r2.8.0-transformer-translate-func-v2-32-1vm
              cronjob.batch/tf-r2.8.0-transformer-translate-func-v3-32
              EOF
              
              delete_list=$(kubectl get cronjob --namespace=automated -l benchmarkId -o name | grep -vx -f tests.txt)
              if [[ "$delete_list" ]]; then
                kubectl delete $delete_list;
              fi
            "command":
            - "bash"
            - "-cx"
            "image": "google/cloud-sdk"
            "name": "clean"
          "restartPolicy": "Never"
          "serviceAccount": "cronjob-cleaner"
  "schedule": "0 */4 * * *"